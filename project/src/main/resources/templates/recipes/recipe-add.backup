<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Recipe</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
          crossorigin="anonymous">
</head>
<body class="container mt-5">
    <h2>Create Recipe</h2>
    <form th:action="@{/admin/recipe/new}" th:object="${recipe}" method="post">
        <div class="mb-3">
            <label for="recipe_id" class="form-label">Recipe ID:</label>
            <input type="text" class="form-control" id="recipe_id" th:field="*{recipe_id}" />
        </div>
        <div class="mb-3">
            <label for="user_id" class="form-label">User ID:</label>
            <input type="text" class="form-control" id="user_id" th:field="*{user_id}" />
        </div>
        <div class="mb-3">
            <label for="title" class="form-label">Title:</label>
            <input type="text" class="form-control" id="title" th:field="*{title}" />
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Description:</label>
            <textarea class="form-control" id="description" th:field="*{description}"></textarea>
        </div>

        <div id="ingredientsSection">
            <h4>Ingredients</h4>
            <div th:each="ingredient, status : *{ingredients}" class="ingredient-block">
                <div class="mb-3">
                    <label th:for="${'ingredients[' + status.index + '].name'}" class="form-label">Ingredient:</label>
                    <select class="form-control" th:field="*{ingredients[__${status.index}__].name}">
                        <option value="">Select an ingredient</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label th:for="${'ingredients[' + status.index + '].quantity'}" class="form-label">Quantity:</label>
                    <input type="number" class="form-control" th:field="*{ingredients[__${status.index}__].quantity}" />
                </div>
                <div class="mb-3">
                    <label th:for="${'ingredients[' + status.index + '].unit'}" class="form-label">Unit:</label>
                    <select class="form-control" th:field="*{ingredients[__${status.index}__].unit}">
                        <option value="gramai">gramai</option>
                        <option value="mililitrai">mililitrai</option>
                        <option value="šaukštai">šaukštai</option>
                        <option value="šaukšteliai">šaukšteliai</option>
                    </select>
                </div>
                <button type="button" class="btn btn-danger" onclick="deleteIngredient(this)">Delete</button>
            </div>
        </div>
        
        <button type="button" onclick="addIngredient()" class="btn btn-secondary">Add Ingredient</button>

        <button type="submit" class="btn btn-primary">Create Recipe</button>
    </form>

    <div id="ingredientTable">
    </div>

    <br>

    <p><a th:href="@{/admin/recipes}" class="btn btn-info">Back to Recipes List</a></p>
    <p class="mt-3"><a href="/admin/dashboard" class="btn btn-secondary">Back to Dashboard</a></p>

    <script>
        function addIngredient() {
            var ingredientsSection = document.getElementById("ingredientsSection");

            var ingredientDiv = document.createElement("div");
            ingredientDiv.classList.add("mb-3");

            var nameLabel = document.createElement("label");
            nameLabel.textContent = "Ingredient:";
            nameLabel.classList.add("form-label");

            var nameSelect = document.createElement("select");
            nameSelect.classList.add("form-control");

            var quantityLabel = document.createElement("label");
            quantityLabel.textContent = "Quantity:";
            quantityLabel.classList.add("form-label");

            var quantityInput = document.createElement("input");
            quantityInput.type = "number";
            quantityInput.classList.add("form-control");
            quantityInput.setAttribute("oninput", "this.value = Math.abs(this.value)");

            var unitLabel = document.createElement("label");
            unitLabel.textContent = "Unit:";
            unitLabel.classList.add("form-label");

            var unitSelect = document.createElement("select");
            unitSelect.classList.add("form-control");
            var unitOptions = ["vienetai","gramai", "mililitrai", "šaukštai", "šaukšteliai"];
            for (var i = 0; i < unitOptions.length; i++) {
                var option = document.createElement("option");
                option.value = unitOptions[i];
                option.text = unitOptions[i];
                unitSelect.add(option);
            }

            var deleteButton = document.createElement("button");
            deleteButton.type = "button";
            deleteButton.classList.add("btn", "btn-danger");
            deleteButton.textContent = "Delete";
            deleteButton.onclick = function () {
                deleteIngredient(this);
            };

            ingredientDiv.appendChild(nameLabel);
            ingredientDiv.appendChild(nameSelect);
            ingredientDiv.appendChild(quantityLabel);
            ingredientDiv.appendChild(quantityInput);
            ingredientDiv.appendChild(unitLabel);
            ingredientDiv.appendChild(unitSelect);
            ingredientDiv.appendChild(deleteButton);

            // Pridėkite naujus laukus
            var recipeIdInput = document.createElement("input");
            recipeIdInput.type = "hidden";
            recipeIdInput.name = "recipe_id";
            recipeIdInput.value = document.getElementById("recipe_id").value;

            var userIdInput = document.createElement("input");
            userIdInput.type = "hidden";
            userIdInput.name = "user_id";
            userIdInput.value = document.getElementById("user_id").value;

            ingredientDiv.appendChild(recipeIdInput);
            ingredientDiv.appendChild(userIdInput);

            ingredientsSection.appendChild(ingredientDiv);
        

            tableRow.innerHTML = "";
            tableRow.appendChild(ingredientBlock);
        }

        function saveEditedRow(saveButton, tableRow) {

            var newRowHTML = `
                <div class="col">${saveButton.parentElement.parentElement.querySelector('.ingredientName').value}</div>
                <div class="col">${saveButton.parentElement.parentElement.querySelector('.quantity').value}</div>
                <div class="col">${saveButton.parentElement.parentElement.querySelector('.unit').value}</div>
                <div class="col">
                    <button type="button" class="btn btn-info" onclick="editRow(this)">Edit</button>
                    <button type="button" class="btn btn-danger" onclick="deleteRow(this)">Delete</button>
                </div>
            `;

            tableRow.innerHTML = newRowHTML;
        }

        function cancelEditRow(cancelButton, tableRow) {

            var oldRowHTML = `
                <div class="col">${tableRow.querySelector('.oldIngredientName').textContent}</div>
                <div class="col">${tableRow.querySelector('.oldQuantity').textContent}</div>
                <div class="col">${tableRow.querySelector('.oldUnit').textContent}</div>
                <div class="col">
                    <button type="button" class="btn btn-info" onclick="editRow(this)">Edit</button>
                    <button type="button" class="btn btn-danger" onclick="deleteRow(this)">Delete</button>
                </div>
            `;

            tableRow.innerHTML = oldRowHTML;
        }

    </script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.2/js/bootstrap.min.js"></script>
</body>
</html>
